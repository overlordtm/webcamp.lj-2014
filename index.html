<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>Web @ Desktop</title>

		<meta name="description" content="desktop applications powered by web technologies">
		<meta name="author" content="Andraz Vrhovec">

		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<link rel="stylesheet" href="css/reveal.min.css">
		<link rel="stylesheet" href="css/theme/default.css" id="theme">

		<!-- For syntax highlighting -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- If the query includes 'print-pdf', include the PDF print sheet -->
		<script>
			if( window.location.search.match( /print-pdf/gi ) ) {
				var link = document.createElement( 'link' );
				link.rel = 'stylesheet';
				link.type = 'text/css';
				link.href = 'css/print/pdf.css';
				document.getElementsByTagName( 'head' )[0].appendChild( link );
			}
		</script>

		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

	<body>

		<div class="reveal">

			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">
				<section>
					<h1>Web @ Desktop</h1>
					<h3>desktop applications powered by web technologies</h3>
					<p>
						<small>
							Andraz Vrhovec
							<br>
							Webcamp Ljubljana, April 2014
						</small>
					</p>
				</section>

				<section>
					<section>
						<img src="imgs/cross.jpg">
					</section>

					<section>
						<img src="imgs/one.jpg">
					</section>

					<section>
						<h2>It is a bit like this</h2>
						<img src="imgs/jenga.jpg">
					</section>
				</section>

				<section>
					<section>
						<h2>What are my options?</h2>
					</section>
					<section>
						<h2>If you have time, money and resources ...</h2>
						<p>
							Do not mess around with HTML apps, just do it old school.
						</p>
					</section>
					<section>
						<h2>... but probably you do not have at least one of those things</h2>
						<p>
							You can still make it with HTML, JavaScript and your language of choice. Which can be JavaScript again ;)
						</p>
					</section>
				</section>

				<section>
					<h2>Ingredients</h2>
					<ul>
						<li>HTTP server (optional)</li>
						<li>Backed code in your favorite language</li>
						<li>REST API to call backend from frontend</li>
						<li>Frontend with HTML and JavaScript (and its derivatives)</li>
					</ul>
				</section>

				<section>
					<section>
						<h2>Minimalistic approach</h2>
						Make application with embedded web server serving on localhost and use user's browser as client.
					</section>
					<section>
						<img src="imgs/trollface.jpg">
					</section>
					<section>
						<h2>Some people use IE. Maybe even IE6!</h2>
						And you have to maintain all the hacks to make app work corectly in gazillion of different browsers. Basically problem that web developers deal with everyday.
					</section>
				</section>

				<section>
					<section>
						<h2>We can do better<h2>
					</section>
				</section>

				<section>
					<section>
						<h2>There are quite a few frameworks out there</h2>
						<h4>And I have zero experience with most of them</h4>
					</section>

					<section>
						<h2>Overview</h2>
						<p>
							<ul>
								<li><a href="http://www.tidesdk.org/" target="_blank">TideSDK</a></li>
								<li><a href="https://github.com/rogerwang/node-webkit" target="_blank">node-webkit</a></li>
								<li><a href="http://deskshell.org/" target="_blank">DeskShell</a></li>
								<li><a href="https://github.com/adobe/brackets-shell" target="_blank">Brackets shell</a></li>
								<li><a href="https://code.google.com/p/chromiumembedded/" target="_blank">Chromium Embedded Framework (CEF)</a></li>
								<li>There <a href="http://stackoverflow.com/questions/11015811/html5-desktop-wrapper-framework" target="_blank">must</a> be <a href="https://www.google.com/search?client=ubuntu&channel=fs&q=tide+sdk+traz+icon&ie=utf-8&oe=utf-8#channel=fs&q=html5+desktop+app+framework" target="_blank">more</a></li>
							</ul>
						</p>
						<p>
							<small>There is some <a href="http://clintberry.com/2013/html5-apps-desktop-2013/" target="_blank">overview</a> of frameworks (it is almost year old)</small>
						</p>
					</section>
				</section>

				<section>
					<section>
						<img src="imgs/way.jpg">
					</section>

					<section>
						<h2>My way</h2>
						<ul>
							<li>Go as backend language</li>
							<li>AngularJS with CoffeeScript for frontend</li>
							<li>Bootstrap</li>
							<li>Chromium Embedded Framework</li>
							<li>Makefiles and Gruntfiles to glue everything togehter and make package out of it</li>
						</ul>
					</section>


					<section>
						<h2>Why Go(lang)?</h2>
						<ul>
							<li>It compiles to executables</li>
							<li>Easy to mix with C/C++, to support more low level stuff</li>
							<li>Good suport for low level stuff by syscall package</li>
							<li>Staticaly typed. You will thank for that later ;)</li>
							<li>Great support for platform specific code</li>
							<li>Easy concurrency</li>
						</ul>
					</section>

					<section>
						<h2>Why AngularJS and CoffeeScript?</h2>
						Actually does not really matter, just choose what you are comfortable with. In my case the above two.
					</section>

					<section>
						<h2>Why Chromium Embedded Framework</h2>
						<ul>
							<li>Webkit based</li>
							<li>Minimalistic, just take whay you want, no bloat (except for the shared library size)</li>
							<li>Go bindings for CEF did not work on Windows XP, so I created separate executable written in C++, that just opens Chromium window and serves content from local server (Go). Like <a href="https://github.com/adobe/brackets-shell" target="_blank">Brackets shell</a>, just simpler.</li>
						</ul>
					</section>
				</section>

				<section>
					<section>
						<h2>The backend</h2>

						<pre><code data-trim>
							import(
								"net/http"
								"github.com/gorilla/mux"
								...
							)

							// implement you server here :)
						</code></pre>
					</section>

					<section>
						<h2>If you want a tray icon</h2>

						<pre><code>
							import(
								"github.com/overlordtm/trayhost"
							)

							menuItems = trayhost.MenuItems{
								// MenuItem{title, disabled, callback func}
								trayhost.MenuItem{"Your cool app name",	true, nil},
								// separator
								trayhost.MenuItem{"", true,	nil},
								trayhost.MenuItem{"Open", false, openChrome},
								trayhost.MenuItem{"Exit", false, func() {os.Exit(0)}}
							}

							// setup tray (second parameter is 
							// tray icon generated by make_icon.sh)
							trayhost.Initialize("Name", resources.TrayIcon, menuItems)
							// Enter the host system's event loop. Will loop forever.
							trayhost.EnterLoop()

						</code></pre>
						<small>
						<a href="https://github.com/overlordtm/trayhost" target="_blank">overlordtm/trayhost</a> is fork of original <a href="https://github.com/cratonica/trayhost" target="_blank">trayhost</a>, but more flexible. Supports Window XP and up, OSX 10.7 and up, Linux distros with Gtk2. For Ubuntu with Unity it needs libappindicator1 package.
						</small>
					</section>

					<section>
							<h2>Embed HTML and JS files into executable</h2>
							Have less files to ship with your app. And prevent people from modifying them.
					</section>

					<section>
						<h2>Tools that can help:</h2>
						<ul>
							<li><a href="https://github.com/overlordtm/embed" target="_blank">embed</a></li>
							<li><a href="https://github.com/overlordtm/embedder" target="_blank">embedder</a></li>
						</ul>
						<p>
							<small>
								Again forked from original <a href="https://github.com/cratonica" target="_blank">repositories</a> to patch a small bug. Got to submit pull request :)
							</small>
						</p>
					</section>

					<section>
						<h2>If you need to do some OS specific stuff</h2>
						<pre><code>

							// +build windows
							package winstuff

							import (
								"syscall"
								"unsafe"
								...
							)

							const (
								DRIVE_UNKNOWN     = 0
								DRIVE_NO_ROOT_DIR = 1
								DRIVE_REMOVABLE   = 2
								DRIVE_FIXED       = 3
								DRIVE_REMOTE      = 4
								DRIVE_CDROM       = 5
								DRIVE_RAMDISK     = 6
							)

							var (
								modkernel32          = syscall.MustLoadDLL("Kernel32.dll")
								procGetLogicalDrives = modkernel32.MustFindProc("GetLogicalDrives")
								procGetDriveType     = modkernel32.MustFindProc("GetDriveTypeW")
							)

							func getLogicalDriveStrings() (drives []string) {
								drivesMask, _, _ := procGetLogicalDrives.Call()

								letter := byte('A')
								for drivesMask > 0 {
									if drivesMask&uintptr(1) != 0 {
										drive := fmt.Sprintf("%c:\\", letter)
										// show only hard drives, no other stuff
										if getDriveType(drive) == DRIVE_FIXED {
											drives = append(drives, drive)
										}
									}
									letter++
									drivesMask = drivesMask >> 1
								}
								return
							}

							func getDriveType(name string) int {
								driveType, _, _ := procGetDriveType.Call(uintptr(unsafe.Pointer(syscall.StringToUTF16Ptr(name))))
								return int(driveType)
							}

						</code></pre>

						<small>
							<a href="http://msdn.microsoft.com/en-us/library/ff818516%28v=vs.85%29.aspx" target="_blank">Win32 API</a> and <a href="http://golang.org/pkg/syscall/" target="_blank">syscall</a> package are your fiends. For other OS substitute Win32 API for its equivalent.
						</small>

					</section>
				</section>

				<section>
					<section>
						<h2>Chrome window</h2>
						If you can get along with <a href="https://github.com/CzarekTomczak/cef2go/issues/6" target="_blank">no support</a> for Windows XP, use <a href="https://github.com/CzarekTomczak/cef2go" target="_blank">cef2go</a>. This way you put all the stuff into one executable.
					</section>

					<section>
						<h2>otherwise</h2>
						Go to <a href="http://cefbuilds.com/" target="_blank">CEF3 builds</a> and download packages for your target platforms. Basically all what you need is in cef_simple project inside package. Just tweak it to your needs and compile it. You might need Visual Studio or XCode :)
					</section>
				</section>

				<section>
					<section>
						<h2>Tips</h2>
					</section>

					<section>
						<h2>Mind the encoding</h2>
						<p>
							When using non english languages with strange characters. Slovenian for example. Go uses UTF8 for strings.
						</p>
						
					</section>

					<section>
						<h2>Windows</h2>
						<pre><code>syscall.StringToUTF16Ptr(name)</code></pre>
					</section>

					<section>
						<h2>OS X</h2>
						<pre><code>[NSString stringWithCString:title encoding:NSUTF8StringEncoding]</code></pre>
					</section>

					<section>
						<h2>Linux</h2>
						It just works. So far ...
					</section>

					<section>
						<h2>Use Go build constraints</h2>
						<p>
							To implement platform specific functions. 
						</p>
						<p><small>
							You can suffix file with _windows.go and it will be build only on Windows. Same goes for _darwin.go and _linux.go. More about <a href="http://golang.org/pkg/go/build/" target="_blank">that</a>.
						</small></p>
					</section>

					<section>
						<h2>Use Go ldsflags -X</h2>
						<p>
							Set symbols at compile time. <a href="http://golang.org/cmd/ld/" target="_blank">Docs</a>
						</p>
						<pre><code>
							go run -ldflags "-X main.version 0.0.1" main.go
						</code></pre>
					</section>

					<section>
						<h2>Mind the security</h2>
						<p>
							Your app will probably have access to resources that a normal web app does not have. Make sure REST API calls that can do damage to the system are done in safe manner. Like <a href="https://www.owasp.org/index.php/Cross-Site_Request_Forgery_%28CSRF%29" target="_blank">CSRF</a> for example.
						</p>
					</section>

				</section>

				<section>
					<section>
						<h2>Packaging</h2>
					</section>

					<section>
						<h2>Windows</h2>
						You will need some kind of installer. You can create it with <a href="http://nsis.sourceforge.net/Main_Page" target="_blank">NSIS</a>. Take a look at <a href="http://nsis.sourceforge.net/NSIS_Studio" target="_blank">NSIS Studio</a> for easier start.
					</section>

					<section>
						<h2>OS X</h2>
						<p>You need to create an application bundle out of it. Application bundle is just a folder with .app suffix and special hierarchy. Nothing <a href="https://developer.apple.com/library/mac/documentation/CoreFoundation/Conceptual/CFBundles/BundleTypes/BundleTypes.html#//apple_ref/doc/uid/10000123i-CH101-SW13" target="_blank">scary</a>. Can be done by shell script or in XCode. Just create an empty project, remove compile step and add "copy steps" for resources you need.</p>
					</section>

					<section>
						<h2>OS X cont.</h2>
						<p>Once you have application bundle, you probably want to create a dmg (disk image) for distribution. There are some tools, but mostly GUI, so not really useful if you want to have automated build process. You can write a <a href="https://gist.github.com/overlordtm/11304070#file-dmgbuilder-py" target="_blank">script</a></p>
						<small>Code on link is awful, but works good enough</small>
					</section>
				</section>

				<section>
					<h1>Thanks</h1>
					<a href="https://twitter.com/overlord_tm">@overlord_tm</a>
					<br/>

					<p>
					<small>
						Slides at <a href="http://overlordtm.github.io/webcamp.lj-2014">http://overlordtm.github.io/webcamp.lj-2014</a>
					</small>
					</p>
				</section>

			</div>

		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.min.js"></script>

		<script>

			// Full list of configuration options available here:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,

				theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
				transition: Reveal.getQueryHash().transition || 'default', // default/cube/page/concave/zoom/linear/fade/none

				// Parallax scrolling
				// parallaxBackgroundImage: 'https://s3.amazonaws.com/hakim-static/reveal-js/reveal-parallax-1.jpg',
				// parallaxBackgroundSize: '2100px 900px',

				// Optional libraries used to extend on reveal.js
				dependencies: [
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
					{ src: 'plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
				]
			});

		</script>

	</body>
</html>
